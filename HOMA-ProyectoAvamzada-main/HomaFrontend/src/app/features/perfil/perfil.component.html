<div class="profile-container">
  <!-- Sidebar -->
  <aside class="profile-sidebar">
    <div class="profile-card">
      <div class="profile-avatar" (click)="triggerFileInput()">
        <img
          [src]="previewUrl || 'assets/images/avatar.jpg'"
          alt="Profile"
          onerror="this.src='https://via.placeholder.com/150'"
        />
        <div class="avatar-overlay">
          <i class="fas fa-camera"></i>
          <span>Cambiar foto</span>
        </div>
      </div>
      <input
        type="file"
        id="fileInput"
        accept="image/*"
        (change)="onFileSelected($event)"
        style="display: none;"
      />
      <h2 class="profile-name">{{ displayName || 'Usuario' }}</h2>
      <p class="profile-email">{{ displayEmail || 'Sin correo' }}</p>
    </div>

    <nav class="profile-nav">
      <button
        class="nav-item"
        [class.active]="activeSection === 'myProfile'"
        (click)="setActiveSection('myProfile')"
      >
        <i class="fas fa-user"></i>
        <span>Mi Perfil</span>
      </button>

      <button
        class="nav-item"
        [class.active]="activeSection === 'misReservas'"
        (click)="setActiveSection('misReservas')"
      >
        <i class="fas fa-calendar-check"></i>
        <span>Mis Reservas</span>
      </button>

      <!-- Opción solo para Anfitriones -->
      <button
        *ngIf="isAnfitrion"
        class="nav-item"
        [class.active]="activeSection === 'misAlojamientos'"
        (click)="setActiveSection('misAlojamientos')"
      >
        <i class="fas fa-home"></i>
        <span>Mis Alojamientos</span>
      </button>

      <!-- Opción solo para Anfitriones -->
      <button
        *ngIf="isAnfitrion"
        class="nav-item"
        [class.active]="activeSection === 'reservasAnfitrion'"
        (click)="setActiveSection('reservasAnfitrion')"
      >
        <i class="fas fa-calendar-alt"></i>
        <span>Reservas Recibidas</span>
      </button>

      

      <!-- Opción solo para Anfitriones -->
      <button
        *ngIf="isAnfitrion"
        class="nav-item"
        [class.active]="activeSection === 'favoritosAlojamientos'"
        (click)="setActiveSection('favoritosAlojamientos')"
      >
        <i class="fas fa-heart-circle"></i>
        <span>Interés en Mis Alojamientos</span>
      </button>

      <a
        routerLink="/favoritos"
        class="nav-item"
        routerLinkActive="active"
      >
        <i class="fas fa-heart"></i>
        <span>Favoritos</span>
      </a>
      <button
        class="nav-item"
        [class.active]="activeSection === 'history'"
        (click)="setActiveSection('history')"
      >
        <i class="fas fa-history"></i>
        <span>Historial</span>
      </button>
      <button
        class="nav-item"
        [class.active]="activeSection === 'settings'"
        (click)="setActiveSection('settings')"
      >
        <i class="fas fa-cog"></i>
        <span>Configuración</span>
      </button>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="profile-main">
    <div class="profile-header">
      <h1>{{ getSectionTitle() }}</h1>
      <div class="header-actions">
        <button class="btn-icon">
          <i class="fas fa-bell"></i>
        </button>
        <div class="user-avatar-small">
          <img [src]="previewUrl || 'assets/images/avatar.jpg'" alt="User" onerror="this.src='https://via.placeholder.com/40'" />
        </div>
      </div>
    </div>

    <div *ngIf="isLoading" class="loading-message">
      Cargando informacion del perfil...
    </div>

    <ng-container *ngIf="!error && !isLoading; else errorTemplate">
      <!-- Mi Perfil -->
      <div class="content-grid" *ngIf="activeSection === 'myProfile'">
        <!-- Profile Info Section -->
        <section class="profile-info-card">
          <div class="profile-info-header">
            <div class="profile-info-avatar">
              <img [src]="'assets/images/avatar.jpg'" alt="Profile" onerror="this.src='https://via.placeholder.com/120'" />
            </div>
            <div class="profile-info-details">
              <h2>{{ displayName || 'Usuario' }}</h2>
              <p>Joined in 2021</p>
              <div class="verified-badge">
                <i class="fas fa-check-circle"></i>
                Verified
              </div>
            </div>
            <button class="btn-edit-profile" (click)="toggleEditMode()">{{ isEditMode ? 'Cancelar' : 'Editar mi perfil' }}</button>
          </div>

          <!-- Edit Profile Form -->
          <div class="edit-profile-form" *ngIf="isEditMode">
            <form [formGroup]="personalForm" (ngSubmit)="saveProfile()">
              <h3>Información Personal</h3>
              <div class="form-grid">
                <div class="form-group full-width">
                  <label for="edit-nombre">Nombre</label>
                  <input
                    id="edit-nombre"
                    type="text"
                    formControlName="nombre"
                    class="form-control"
                    placeholder="Ingresa tu nombre completo"
                  />
                </div>
                <div class="form-group full-width">
                  <label for="edit-email">Correo electrónico</label>
                  <input
                    id="edit-email"
                    type="email"
                    formControlName="email"
                    class="form-control"
                    placeholder="tu@email.com"
                  />
                </div>
                <div class="form-group full-width">
                  <label for="edit-telefono">Teléfono</label>
                  <input
                    id="edit-telefono"
                    type="tel"
                    formControlName="telefono"
                    class="form-control"
                    placeholder="Ingresa tu teléfono"
                  />
                </div>
              </div>

              <div class="form-actions">
                <button type="button" class="btn-cancel" (click)="toggleEditMode()">
                  Cancelar
                </button>
                <button type="submit" class="btn-save" [disabled]="isSaving || personalForm.invalid">
                  <i class="fas fa-spinner fa-spin" *ngIf="isSaving"></i>
                  {{ isSaving ? 'Guardando...' : 'Guardar cambios' }}
                </button>
              </div>
            </form>
          </div>
        </section>

        <!-- Upcoming Bookings -->
      </div>

      <!-- Mis Alojamientos (Solo para Anfitriones) -->
      <div *ngIf="activeSection === 'misAlojamientos' && isAnfitrion" class="host-dashboard">
        <!-- Stats Cards -->
        <div class="stats-grid">
          <div class="stat-card">
            <p class="stat-label">Ganancias este mes</p>
            <h2 class="stat-value">$2,450</h2>
          </div>
          <div class="stat-card">
            <p class="stat-label">Reservas activas</p>
            <h2 class="stat-value">12</h2>
          </div>
          <div class="stat-card">
            <p class="stat-label">Calificación promedio</p>
            <h2 class="stat-value">4.8 <i class="fas fa-star"></i></h2>
          </div>
        </div>

        <!-- My Listings -->
        <section class="my-listings">
          <h3>Mis Alojamientos ({{ totalAlojamientos }})</h3>

          <div *ngIf="isLoadingAlojamientos" class="loading-message">
            Cargando alojamientos...
          </div>

          <div *ngIf="!isLoadingAlojamientos && misAlojamientos.length === 0" class="empty-message">
            <i class="fas fa-home"></i>
            <p>Aún no tienes alojamientos publicados</p>
          </div>

          <div class="listings-table" *ngIf="!isLoadingAlojamientos && misAlojamientos.length > 0">
            <div class="table-header">
              <div>Alojamiento</div>
              <div>Ciudad</div>
              <div>Precio/Noche</div>
              <div>Estado</div>
              <div>Favoritos</div>
              <div>Acciones</div>
            </div>
            <div class="table-row" *ngFor="let alojamiento of misAlojamientos">
              <div>{{ alojamiento.titulo }}</div>
              <div>{{ alojamiento.ciudad }}</div>
              <div>${{ alojamiento.precioPorNoche }}</div>
              <div>
                <span class="badge"
                      [class.badge-pendiente]="alojamiento.estado === 'PENDIENTE'"
                      [class.badge-active]="alojamiento.estado === 'ACTIVO'"
                      [class.badge-inactive]="alojamiento.estado === 'INACTIVO'">
                  <span *ngIf="alojamiento.estado === 'PENDIENTE'">Pendiente</span>
                  <span *ngIf="alojamiento.estado === 'ACTIVO'">Activo</span>
                  <span *ngIf="alojamiento.estado === 'INACTIVO'">Inactivo</span>
                </span>
              </div>
              <div>
                <span class="favoritos-count">
                  <i class="fas fa-heart text-red-500"></i>
                  {{ alojamiento.totalFavoritos || 0 }}
                </span>
              </div>
              <div><button class="btn-link" [routerLink]="['/alojamientos', alojamiento.id]">Ver</button></div>
            </div>
          </div>
          <button class="btn-new-listing" routerLink="/anfitrion">
            <i class="fas fa-plus"></i>
            Nuevo Alojamiento
          </button>
        </section>

        <!-- Recent Bookings -->
        <section class="recent-bookings-section">
          <h3>Reservas Recientes</h3>
          <div class="bookings-table">
            <div class="table-header">
              <div>Huésped</div>
              <div>Alojamiento</div>
              <div>Fechas</div>
              <div>Estado</div>
            </div>
            <div class="table-row">
              <div>Emily Carter</div>
              <div>Charming Apartment...</div>
              <div>July 15 - July 20</div>
              <div><span class="badge badge-confirmed">Confirmada</span></div>
            </div>
            <div class="table-row">
              <div>David Lee</div>
              <div>Seaside Villa...</div>
              <div>August 1 - August 7</div>
              <div><span class="badge badge-confirmed">Confirmada</span></div>
            </div>
            <div class="table-row">
              <div>Sophia Clark</div>
              <div>Mountain Cabin...</div>
              <div>July 22 - July 28</div>
              <div><span class="badge badge-pending">Pendiente</span></div>
            </div>
          </div>
        </section>
      </div>

      <!-- Sección Mis Reservas -->
      <div *ngIf="activeSection === 'misReservas'" class="reservas-section">
        <h2>Mis Reservas</h2>

        <!-- Loading -->
        <div *ngIf="isLoadingReservas" class="loading-state">
          <div class="spinner"></div>
          <p>Cargando reservas...</p>
        </div>

        <!-- Reservas -->
        <div *ngIf="!isLoadingReservas && misReservas.length > 0" class="reservas-grid">
          <div *ngFor="let reserva of misReservas" class="reserva-card">
            <div class="reserva-header">
              <h3>{{ reserva.tituloAlojamiento }}</h3>
              <span class="badge"
                    [class.badge-pendiente]="reserva.estado === 'PENDIENTE'"
                    [class.badge-confirmada]="reserva.estado === 'CONFIRMADA'"
                    [class.badge-cancelada]="reserva.estado === 'CANCELADA'"
                    [class.badge-completada]="reserva.estado === 'COMPLETADA'">
                {{ reserva.estado }}
              </span>
            </div>
            <div class="reserva-info">
              <div class="info-item">
                <i class="fas fa-map-marker-alt"></i>
                <span>{{ reserva.ciudadAlojamiento }}</span>
              </div>
              <div class="info-item">
                <i class="fas fa-calendar"></i>
                <span>{{ reserva.fechaEntrada | date:'dd/MM/yyyy' }} - {{ reserva.fechaSalida | date:'dd/MM/yyyy' }}</span>
              </div>
              <div class="info-item">
                <i class="fas fa-users"></i>
                <span>{{ reserva.cantidadHuespedes }} huésped{{ reserva.cantidadHuespedes > 1 ? 'es' : '' }}</span>
              </div>
              <div class="info-item">
                <i class="fas fa-dollar-sign"></i>
                <span class="price">${{ reserva.precio }}</span>
              </div>
            </div>
            <div class="reserva-actions">
              <button class="btn-link" [routerLink]="['/alojamientos', reserva.alojamientoId]">Ver Alojamiento</button>
              <button *ngIf="reserva.estado === 'PENDIENTE' || reserva.estado === 'CONFIRMADA'"
                      class="btn-cancel">
                Cancelar Reserva
              </button>
            </div>
          </div>
        </div>

        <!-- Sin reservas -->
        <div *ngIf="!isLoadingReservas && misReservas.length === 0" class="empty-state">
          <i class="fas fa-calendar-times"></i>
          <h3>No tienes reservas</h3>
          <p>Explora nuestros alojamientos y haz tu primera reserva</p>
          <button class="btn-primary" routerLink="/buscar">Buscar Alojamientos</button>
        </div>
      </div>

      <!-- Sección Reservas del Anfitrión -->
      <div *ngIf="activeSection === 'reservasAnfitrion'" class="reservas-section">
        <h2>Reservas Recibidas</h2>
        <p class="section-subtitle">Reservas realizadas en tus alojamientos</p>

        <!-- Loading -->
        <div *ngIf="isLoadingReservasAnfitrion" class="loading-state">
          <div class="spinner"></div>
          <p>Cargando reservas...</p>
        </div>

        <!-- Reservas -->
        <div *ngIf="!isLoadingReservasAnfitrion && reservasAnfitrion.length > 0" class="reservas-grid">
          <div *ngFor="let reserva of reservasAnfitrion" class="reserva-card">
            <div class="reserva-header">
              <h3>{{ reserva.tituloAlojamiento }}</h3>
              <span class="badge"
                    [ngClass]="getEstadoBadgeClass(reserva.estado)">
                {{ reserva.estado }}
              </span>
            </div>
            <div class="reserva-info">
              <div class="info-item">
                <i class="fas fa-user"></i>
                <span><strong>Huésped:</strong> {{ reserva.nombreHuesped }}</span>
              </div>
              <div class="info-item">
                <i class="fas fa-envelope"></i>
                <span><strong>Email:</strong> {{ reserva.emailHuesped }}</span>
              </div>
              <div class="info-item">
                <i class="fas fa-phone"></i>
                <span><strong>Teléfono:</strong> {{ reserva.telefonoHuesped || 'No proporcionado' }}</span>
              </div>
              <div class="info-item">
                <i class="fas fa-map-marker-alt"></i>
                <span>{{ reserva.ciudadAlojamiento }}</span>
              </div>
              <div class="info-item">
                <i class="fas fa-calendar"></i>
                <span>{{ reserva.fechaEntrada | date:'dd/MM/yyyy' }} - {{ reserva.fechaSalida | date:'dd/MM/yyyy' }}</span>
              </div>
              <div class="info-item">
                <i class="fas fa-users"></i>
                <span>{{ reserva.cantidadHuespedes }} huésped{{ reserva.cantidadHuespedes > 1 ? 'es' : '' }}</span>
              </div>
              <div class="info-item">
                <i class="fas fa-dollar-sign"></i>
                <span class="price">${{ reserva.precio }}</span>
              </div>
            </div>
            <div class="reserva-actions">
              <!-- Botones según el estado -->
              <button *ngIf="puedeConfirmar(reserva)"
                      class="btn-success"
                      (click)="confirmarReserva(reserva.id)"
                      title="Confirmar reserva">
                <i class="fas fa-check"></i> Confirmar
              </button>

              <button *ngIf="puedeRechazar(reserva)"
                      class="btn-danger"
                      (click)="rechazarReserva(reserva.id)"
                      title="Rechazar reserva">
                <i class="fas fa-times"></i> Rechazar
              </button>

              <button *ngIf="puedeCompletar(reserva)"
                      class="btn-complete"
                      (click)="completarReserva(reserva.id)"
                      title="Marcar como completada">
                <i class="fas fa-check-double"></i> Completar
              </button>

              <button class="btn-secondary"
                      (click)="verDetalleReserva(reserva)"
                      title="Ver detalles">
                <i class="fas fa-eye"></i> Detalles
              </button>
            </div>
          </div>
        </div>

        <!-- Sin reservas -->
        <div *ngIf="!isLoadingReservasAnfitrion && reservasAnfitrion.length === 0" class="empty-state">
          <i class="fas fa-calendar-times"></i>
          <h3>No tienes reservas recibidas</h3>
          <p>Aún no hay reservas en tus alojamientos</p>
        </div>
      </div>

      <!-- Sección Configuración -->
      <div *ngIf="activeSection === 'settings'" class="settings-section">
        <section class="settings-card">
          <h2>Seguridad de la cuenta</h2>
          <p class="settings-card__subtitle">
            Cambia tu contraseña cuando quieras. Necesitamos confirmar la contraseña actual para proteger tu cuenta.
          </p>

          <form [formGroup]="cambioContrasenaForm" (ngSubmit)="onSubmitCambioContrasena()" class="settings-form">
            <div class="settings-grid">
              <div class="input-group" [class.input-group--error]="cambioContrasenaForm.get('contrasenaActual')?.invalid && (cambioContrasenaForm.get('contrasenaActual')?.dirty || cambioContrasenaForm.get('contrasenaActual')?.touched)">
                <label for="currentPassword">Contraseña actual</label>
                <input
                  id="currentPassword"
                  type="password"
                  placeholder="Ingresa tu contraseña vigente"
                  formControlName="contrasenaActual"
                />
                <small *ngIf="cambioContrasenaForm.get('contrasenaActual')?.hasError('required')">
                  Este campo es obligatorio.
                </small>
              </div>

                <div class="input-group" [class.input-group--error]="cambioContrasenaForm.get('contrasenaNueva')?.invalid && (cambioContrasenaForm.get('contrasenaNueva')?.dirty || cambioContrasenaForm.get('contrasenaNueva')?.touched)">
                  <label for="newPassword">Nueva contraseña</label>
                  <input
                    id="newPassword"
                    type="password"
                    placeholder="Mínimo 8 caracteres"
                    formControlName="contrasenaNueva"
                  />
                  <small *ngIf="cambioContrasenaForm.get('contrasenaNueva')?.hasError('required')">
                    Este campo es obligatorio.
                  </small>
                  <small *ngIf="cambioContrasenaForm.get('contrasenaNueva')?.hasError('minlength')">
                    Debe tener al menos 8 caracteres, una letra mayúscula y un número.
                  </small>
                </div>

              <div class="input-group" [class.input-group--error]="cambioContrasenaForm.get('confirmarContrasena')?.invalid && (cambioContrasenaForm.get('confirmarContrasena')?.dirty || cambioContrasenaForm.get('confirmarContrasena')?.touched)">
                <label for="confirmPassword">Confirmar contraseña</label>
                <input
                  id="confirmPassword"
                  type="password"
                  placeholder="Repite la nueva contraseña"
                  formControlName="confirmarContrasena"
                />
                <small *ngIf="cambioContrasenaForm.get('confirmarContrasena')?.hasError('required')">
                  Este campo es obligatorio.
                </small>
                <small *ngIf="cambioContrasenaForm.get('confirmarContrasena')?.hasError('passwordMismatch')">
                  Las contraseñas no coinciden.
                </small>
              </div>
            </div>

            <div class="settings-actions">
              <button type="submit" class="btn-primary" [disabled]="isChangingPassword">
                <span *ngIf="!isChangingPassword">Actualizar contraseña</span>
                <span *ngIf="isChangingPassword">Guardando cambios...</span>
              </button>
              <p class="helper-text">Consejo: usa una contraseña única y difícil de adivinar.</p>
            </div>
          </form>

          <div *ngIf="passwordChangeSuccess" class="settings-message settings-message--success">
            {{ passwordChangeSuccess }}
          </div>
          <div *ngIf="passwordChangeError" class="settings-message settings-message--error">
            {{ passwordChangeError }}
          </div>
        </section>
      </div>

      <!-- Sección Historial -->
      <div *ngIf="activeSection === 'history'" class="history-section">
        <div class="history-section__intro">
          <div>
            <h2>Historial de actividad</h2>
            <p>Consulta tus reservas como huésped y la actividad de tus alojamientos.</p>
          </div>
          <div class="history-section__actions">
            <button type="button" class="history-card__link" (click)="loadMisReservas()">
              <i class="fas fa-rotate"></i>
              Actualizar datos
            </button>
          </div>
        </div>

        <div class="history-overview">
          <div class="history-metric">
            <p class="history-metric__label">Reservas realizadas</p>
            <h3>{{ misReservas.length }}</h3>
            <span>{{ totalReservasClienteCompletadas }} completadas</span>
          </div>
          <div class="history-metric">
            <p class="history-metric__label">Reservas activas</p>
            <h3>{{ totalReservasClienteActivas }}</h3>
            <span>En curso o pendientes</span>
          </div>
          <div *ngIf="isAnfitrion" class="history-metric">
            <p class="history-metric__label">Reservas recibidas</p>
            <h3>{{ reservasAnfitrion.length }}</h3>
            <span>{{ totalReservasHostCompletadas }} completadas</span>
          </div>
          <div *ngIf="isAnfitrion" class="history-metric">
            <p class="history-metric__label">Alojamientos publicados</p>
            <h3>{{ misAlojamientos.length }}</h3>
            <span *ngIf="historialAlojamientosRecientes.length > 0">
              Último: {{ historialAlojamientosRecientes[0].creadoEn | date:'mediumDate' }}
            </span>
            <span *ngIf="historialAlojamientosRecientes.length === 0">Sin registros</span>
          </div>
        </div>

        <div class="history-grid">
          <section class="history-card">
            <div class="history-card__header">
              <div>
                <p class="history-card__eyebrow">Como huésped</p>
                <h3>Historial de reservas</h3>
                <p>Tus últimas confirmaciones y su estado.</p>
              </div>
              <button type="button" class="history-card__link" (click)="setActiveSection('misReservas')">
                Ver todas
                <i class="fas fa-arrow-right"></i>
              </button>
            </div>

            <div *ngIf="isLoadingReservas" class="history-card__state">
              <div class="spinner"></div>
              <p>Cargando historial...</p>
            </div>

            <ng-container *ngIf="!isLoadingReservas">
              <div *ngIf="historialReservasCliente.length > 0; else emptyGuestHistory" class="history-timeline">
                <article *ngFor="let reserva of historialReservasCliente; trackBy: trackByReservaId" class="history-item">
                  <div class="history-item__content">
                    <div>
                      <p class="history-item__label">Alojamiento</p>
                      <h4>{{ reserva.tituloAlojamiento }}</h4>
                      <span class="history-item__location">
                        <i class="fas fa-location-dot"></i>
                        {{ reserva.ciudadAlojamiento }}
                      </span>
                    </div>
                    <div class="history-item__status-card">
                      <p>{{ getEstadoClienteTitulo(reserva.estado) }}</p>
                      <small>{{ getEstadoClienteHelper(reserva.estado) }}</small>
                    </div>
                  </div>
                  <div class="history-item__meta">
                    <span>
                      <i class="fas fa-calendar"></i>
                      {{ reserva.fechaEntrada | date:'dd/MM/yyyy' }} - {{ reserva.fechaSalida | date:'dd/MM/yyyy' }}
                    </span>
                    <span>
                      <i class="fas fa-users"></i>
                      {{ reserva.cantidadHuespedes }} huésped{{ reserva.cantidadHuespedes > 1 ? 'es' : '' }}
                    </span>
                    <span>
                      <i class="fas fa-wallet"></i>
                      {{ reserva.precio | currency:'COP':'symbol':'1.0-0' }}
                    </span>
                  </div>
                  <footer class="history-item__footer">
                    <span>ID #{{ reserva.id }}</span>
                    <span>Creada el {{ (reserva.creadoEn || reserva.fechaCreacion || reserva.fechaEntrada) | date:'mediumDate' }}</span>
                  </footer>
                </article>
              </div>
            </ng-container>

            <ng-template #emptyGuestHistory>
              <div class="history-card__state history-card__state--empty">
                <i class="fas fa-suitcase-rolling"></i>
                <p>Aún no tienes reservas.</p>
                <span>Cuando confirmes una, aparecerá en este espacio.</span>
                <button type="button" class="btn-primary" routerLink="/buscar">Buscar alojamientos</button>
              </div>
            </ng-template>
          </section>

          <section *ngIf="isAnfitrion" class="history-card">
            <div class="history-card__header">
              <div>
                <p class="history-card__eyebrow">Como anfitrión</p>
                <h3>Actividad de tus alojamientos</h3>
                <p>Revisa las últimas reservas y publicaciones.</p>
              </div>
            </div>

            <div class="history-card__columns">
              <div class="history-column">
                <div class="history-column__header">
                  <h4>Reservas recibidas</h4>
                  <button type="button" class="history-card__link" (click)="setActiveSection('reservasAnfitrion')">
                    Gestionar
                    <i class="fas fa-arrow-right"></i>
                  </button>
                </div>

                <div *ngIf="isLoadingReservasAnfitrion" class="history-card__state">
                  <div class="spinner"></div>
                  <p>Cargando reservas...</p>
                </div>

                <ng-container *ngIf="!isLoadingReservasAnfitrion">
                  <div *ngIf="historialReservasAnfitrion.length > 0; else emptyHostReservations" class="history-timeline">
                    <article *ngFor="let reserva of historialReservasAnfitrion; trackBy: trackByReservaId" class="history-item">
                      <div class="history-item__content">
                        <div>
                          <p class="history-item__label">Huésped</p>
                          <h4>{{ reserva.nombreHuesped }}</h4>
                          <span class="history-item__location">
                            <i class="fas fa-home"></i>
                            {{ reserva.tituloAlojamiento }}
                          </span>
                        </div>
                        <span class="history-item__status" [ngClass]="getEstadoHostClasses(reserva.estado)">
                          {{ getEstadoHostLabel(reserva.estado) }}
                        </span>
                      </div>
                      <div class="history-item__meta">
                        <span>
                          <i class="fas fa-calendar"></i>
                          {{ reserva.fechaEntrada | date:'dd/MM/yyyy' }} - {{ reserva.fechaSalida | date:'dd/MM/yyyy' }}
                        </span>
                        <span>
                          <i class="fas fa-users"></i>
                          {{ reserva.cantidadHuespedes }} huésped{{ reserva.cantidadHuespedes > 1 ? 'es' : '' }}
                        </span>
                        <span>
                          <i class="fas fa-wallet"></i>
                          {{ reserva.precio | currency:'COP':'symbol':'1.0-0' }}
                        </span>
                      </div>
                      <footer class="history-item__footer">
                        <span>Contacto: {{ reserva.emailHuesped || 'sin correo' }}</span>
                        <span>Creada el {{ (reserva.creadoEn || reserva.fechaCreacion || reserva.fechaEntrada) | date:'medium' }}</span>
                      </footer>
                    </article>
                  </div>
                </ng-container>
              </div>

              <div class="history-column">
                <div class="history-column__header">
                  <h4>Alojamientos publicados</h4>
                  <button type="button" class="history-card__link" (click)="setActiveSection('misAlojamientos')">
                    Ver todos
                    <i class="fas fa-arrow-right"></i>
                  </button>
                </div>

                <div *ngIf="isLoadingAlojamientos" class="history-card__state">
                  <div class="spinner"></div>
                  <p>Cargando alojamientos...</p>
                </div>

                <ng-container *ngIf="!isLoadingAlojamientos">
                  <div *ngIf="historialAlojamientosRecientes.length > 0; else emptyAlojamientos" class="history-list">
                    <article *ngFor="let alojamiento of historialAlojamientosRecientes; trackBy: trackByAlojamientoId" class="history-list__item">
                      <div>
                        <p class="history-item__label">Título</p>
                        <h4>{{ alojamiento.titulo }}</h4>
                        <span class="history-item__location">
                          <i class="fas fa-location-dot"></i>
                          {{ alojamiento.ciudad }}
                        </span>
                      </div>
                      <div class="history-list__meta">
                        <span class="history-item__status" [ngClass]="getEstadoAlojamientoClasses(alojamiento.estado)">
                          {{ getEstadoAlojamientoLabel(alojamiento.estado) }}
                        </span>
                        <span>
                          <i class="fas fa-calendar-plus"></i>
                          {{ alojamiento.creadoEn | date:'mediumDate' }}
                        </span>
                      </div>
                    </article>
                  </div>
                </ng-container>
              </div>
            </div>

            <ng-template #emptyHostReservations>
              <div class="history-card__state history-card__state--empty">
                <i class="fas fa-calendar-minus"></i>
                <p>Aún no recibes reservas.</p>
                <span>Comparte tu alojamiento para recibir las primeras solicitudes.</span>
              </div>
            </ng-template>

            <ng-template #emptyAlojamientos>
              <div class="history-card__state history-card__state--empty">
                <i class="fas fa-home"></i>
                <p>Todavía no publicas alojamientos.</p>
                <span>Configura el primero para empezar a generar ingresos.</span>
                <button type="button" class="btn-primary" (click)="setActiveSection('misAlojamientos')">
                  Crear alojamiento
                </button>
              </div>
            </ng-template>
          </section>
        </div>
      </div>

      <!-- Otras secciones -->
      <div *ngIf="activeSection !== 'myProfile' && activeSection !== 'misAlojamientos' && activeSection !== 'misReservas' && activeSection !== 'reservasAnfitrion' && activeSection !== 'history'" class="empty-section">
        <i class="fas fa-construction"></i>
        <h3>Sección en construcción</h3>
        <p>Esta funcionalidad estará disponible próximamente</p>
      </div>
    </ng-container>

    <ng-template #errorTemplate>
      <div class="error-card">
        <p>{{ error }}</p>
        <button class="btn-retry" (click)="loadProfile()">Reintentar</button>
      </div>
    </ng-template>
  </main>
</div>

<!-- Modal Detalle de Reserva -->
<div *ngIf="mostrarModalReserva" class="modal-overlay" (click)="cerrarModalReserva()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Detalle de la Reserva</h2>
      <button class="btn-close" (click)="cerrarModalReserva()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div *ngIf="reservaSeleccionada" class="modal-body">
      <!-- Estado de la reserva -->
      <div class="estado-badge-container">
        <span class="badge-large"
              [class.badge-pendiente]="reservaSeleccionada.estado === 'PENDIENTE'"
              [class.badge-confirmada]="reservaSeleccionada.estado === 'CONFIRMADA'"
              [class.badge-cancelada]="reservaSeleccionada.estado === 'CANCELADA'"
              [class.badge-completada]="reservaSeleccionada.estado === 'COMPLETADA'">
          {{ reservaSeleccionada.estado }}
        </span>
      </div>

      <!-- Información del Alojamiento -->
      <div class="info-section">
        <h3><i class="fas fa-home"></i> Alojamiento</h3>
        <div class="info-grid">
          <div class="info-item-modal">
            <label>Título:</label>
            <span>{{ reservaSeleccionada.tituloAlojamiento }}</span>
          </div>
          <div class="info-item-modal">
            <label>Ciudad:</label>
            <span>{{ reservaSeleccionada.ciudadAlojamiento }}</span>
          </div>
        </div>
      </div>

      <!-- Información del Huésped -->
      <div class="info-section">
        <h3><i class="fas fa-user"></i> Información del Huésped</h3>
        <div class="info-grid">
          <div class="info-item-modal">
            <label>Nombre:</label>
            <span>{{ reservaSeleccionada.nombreHuesped }}</span>
          </div>
          <div class="info-item-modal">
            <label>Email:</label>
            <span>{{ reservaSeleccionada.emailHuesped }}</span>
          </div>
          <div class="info-item-modal">
            <label>Teléfono:</label>
            <span>{{ reservaSeleccionada.telefonoHuesped || 'No proporcionado' }}</span>
          </div>
        </div>
      </div>

      <!-- Información de la Reserva -->
      <div class="info-section">
        <h3><i class="fas fa-calendar-check"></i> Detalles de la Reserva</h3>
        <div class="info-grid">
          <div class="info-item-modal">
            <label>Fecha de entrada:</label>
            <span>{{ reservaSeleccionada.fechaEntrada | date:'EEEE, dd MMMM yyyy':'es' }}</span>
          </div>
          <div class="info-item-modal">
            <label>Fecha de salida:</label>
            <span>{{ reservaSeleccionada.fechaSalida | date:'EEEE, dd MMMM yyyy':'es' }}</span>
          </div>
          <div class="info-item-modal">
            <label>Número de huéspedes:</label>
            <span>{{ reservaSeleccionada.cantidadHuespedes }} huésped{{ reservaSeleccionada.cantidadHuespedes > 1 ? 'es' : '' }}</span>
          </div>
          <div class="info-item-modal">
            <label>Precio total:</label>
            <span class="price-large">${{ reservaSeleccionada.precio }}</span>
          </div>
          <div class="info-item-modal">
            <label>Fecha de solicitud:</label>
            <span>{{ reservaSeleccionada.fechaCreacion | date:'dd/MM/yyyy HH:mm' }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="cerrarModalReserva()">Cerrar</button>
      <button *ngIf="reservaSeleccionada?.estado === 'PENDIENTE'"
              class="btn-success"
              (click)="confirmarReserva(reservaSeleccionada!.id)">
        <i class="fas fa-check"></i> Confirmar Reserva
      </button>
      <button *ngIf="reservaSeleccionada?.estado === 'PENDIENTE'"
              class="btn-danger"
              (click)="rechazarReserva(reservaSeleccionada!.id)">
        <i class="fas fa-times"></i> Rechazar
      </button>
    </div>
  </div>
</div>
